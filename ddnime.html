<html>
<head>
<meta charset='utf-8' />
<title> Dot Decimal Notation IME </title>
<script src="jquery-1.9.1.min.js"></script>
<script src='hosts.json'></script>
</head>
<body>
<div id='plain'style="width:65%; height: 70%; display:inline-block; overflow:auto;"></div>
<div style="width:30%; height: 70%; overflow:auto;display:inline-block">
<h3> plain 0: Basic Multilingual Plain(BMP)</h3>
<ul>
	<li><ul><a>0.0 ~ 31.255</a> Scripts
		<li><ul> <a>0.0 ~ 5.143</a>West Script
			<li> <a>0.0 ~ 3.111</a> Latin & IPA </li>
			<li> <a>3.111 ~ 3.255</a> Greek & Copotic</li>
			<li> <a>4.0 ~ 4.255</a>, <a>5.0 ~ 5.47</a> Cyrillic </li>
			<li> <a>5.48 ~ 5.143</a> Armenian </li>
		</ul></li>
		<li><ul><a>5.144 ~ 8.255</a> Middle East Scripts
			<li> <a>5.144 ~ 5.255</a> Hebrew </li>
			<li> <a>6.0 ~ 7.127</a> Arabic & Syriac </li>
			<li> <a>7.128 ~ 7.191</a> Thaana(Maldive) </li>
			<li> <a>7.192 ~ 7.255</a> Nko(West African) </li>
		</ul></li>
		<li><ul><a>9.0 ~ 16.159</a> Indic Scripts
		</ul></li>
		<li><ul><a>16.160 ~ 27.127</a> other Scripts
		</ul></li>
		<li><ul><a>29.0 ~ 31.255</a> Script Extensions
		</ul></li>
	</ul></li>
	<li><ul><a id='default'>32.0 ~ 43.255</a> Symbols
	</ul></li>
	<li><ul><a>44.0 ~ 46.127</a> supp
	</ul></li>
	<li><ul><a>46.128 ~ 159.255</a> CJK
		<li><a>52.0 ~ 77.191</a> CJK-A</li>
		<li><a>78.0 ~ 159.255</a> CJK-0</li>
	</ul></li>
	<li><ul><a>160.0 ~ 255.255</a> other
	</ul></li>
</ul>
<h3> Plain 1: Supplementary Multilingual Plane(SMP)</h3>
<h3> Plain 2: Supplementary Ideographic Plain(SIP)</h3>
<ul>
	<li><a>2.0.0 ~ 2.166.223</a> CJK-B</li>
	<li><a>2.167.0 ~ 2.183.63</a> CJK-C</li>
	<li><a>2.183.64 ~ 2.184.31</a> CJK-D</li>	
	<li><a>2.184.32 ~ 2.206.175</a> CJK-E</li>
	<li><a>2.206.176 ~ 2.235.239</a> CJK-F</li>
</li>
</div>

<div><input id='code' readOnly></div>

<textarea id='in' style='width:100%; height: 20%;'>
</textarea>
<script>
var ddn = "";
$("#in").bind('keypress', function(event){
	console.log("event.which: " + event.which)
	if (event.which >= 48 && event.which <= 57){
		ddn += event.which - 48;
		$("#code").val(ddn);
	}
	else if (event.which == 46){
		ddn += '.';
		$("#code").val(ddn);
	}
	else if (event.which >= 87 && event.which <= 122){
		ddn += String.fromCharCode(event.which);
		$("#code").val(ddn);
	}
	else if (event.which == 32) {
		old = $("#in").val();
		index = old.lastIndexOf(ddn);
		if (index != -1 ) {old = old.substring(0, index);}
		
		console.log("ddn : " + ddn);
		chr = convert(ddn);
		console.log("chr: "+ chr);
		$("#in").val(old + chr);
		ddn='';
		$("#code").val(ddn);
	}
	else if (event.which == 13) {
		ddn = "";
		$("#code").val(ddn);
	}
	else {
		//ddn = "";
		//$("#code").val(ddn);
	}

});
function convert(input){
	if (isName(input)) input = hosts[input];
	if (isDDN(input)){ return ddn2str(input);}
	else return "";
}
function ddn2str(ddn) {
	var arr=ddn.split('.')
	var ret=0;
	for (var i = 0; i != arr.length; ++i) {
		j = arr.length - i - 1;
		ret += Number(arr[i]) << (8 * j);
	}
	return realFromCharCode(ret);
}

function realFromCharCode(code){
	if (code < 0x10000) return String.fromCharCode(code);
	else {
		H = Math.floor((code - 0x10000) / 0x400) + 0xD800;
		L = (code - 0x10000) % 0x400 + 0xDC00;
		return String.fromCharCode(L, H);
	}
}
function isDDN(str){
	var arr=str.split('.');
	if (arr.length > 3 || arr.length < 1) return false;
	for (var i = 0; i != arr.length; ++i) {
		if (Number(arr[i]) > 255) return false;
		for (var j = 0; j != arr[i].length; ++j) {
			var code = arr[i].charCodeAt(j);
			if (code < 48 || code > 57) return false;
		}
	}
	return true;
}
function isName(str){
	var arr=str.split('.');
	if (arr.length < 1) return false;
	for (var i = 0; i != arr.length; ++i) {
		for (var j = 0; j != arr[i].length; ++j) {
			var code = arr[i].charCodeAt(j);
			if (code < 87 || code > 122) return false;
		}
	}
	return true;
}

//console.log(ddn2str('2.2.3'));
console.log('dd');
console.log(isDDN('2.3.3')? "true" : "false");
console.log(isDDN('23.3f.3')? "true" : "false");
console.log(isDDN('44'));


console.log(isName('a.b'));
console.log(isName('a.b.1a'));
console.log(isName('A.b'));
console.log(isName('ab'));
</script>
<script>
function writetable(plain, block_b, block_e, spot_b, spot_e)
{
	var ret="<table border='1' cellSpacing='0'>"
	for (var i = -1; i != 256; ++i)
	{
		if (i == -1) ret += "<thead>";
		ret += "<tr>";	
		for (var j = -1; j != block_e - block_b + 1; ++j)
		{
			if (i == -1 || j == -1) ret += "<th>";
			else ret += "<td>";
			if (i == -1 && j == -1) ret += "s\\b";
			else if (i == -1 && j != -1) ret += j + block_b;
			else if (j == -1 && i != -1) ret += i;
			else if (j == 0 && i < spot_b 
				|| j == block_e - block_b && i > spot_e) ret += "";
			else ret += "&#" + String(i + (j + block_b) * 256 + plain * 65536) + ";"
			if (i == -1 || j == -1) ret += "</th>";
			else ret += "</td>"
		}
		ret += "</tr>";
		if (i == -1) ret += "</thead>";
	}
	ret +="</table>";
	return ret;
}
$("li a").click(function(){
	arr = $(this).text().split(' ~ ');
	if (arr.length != 2) return;
	begin = arr[0].split('.');
	end = arr[1].split('.');
	if (begin.length == 2 && end.length == 2)
	{
		$("#plain").html(writetable(0, Number(begin[0]), Number(end[0]), Number(begin[1]), Number(end[1])));
	}
	if (begin.length == 3 && end.length == 3 && begin[0] == end[0]){
		$("#plain").html(writetable(Number(begin[0]), Number(begin[1]), Number(end[1]), Number(begin[2]), Number(end[2])));
	}
	//https://stackoverflow.com/questions/673153/html-table-with-fixed-headers
	document.getElementById("plain").addEventListener("scroll", function(){	      		
			var translate = "translate(0,"+this.scrollTop+"px)";
   			this.querySelector("thead").style.transform = translate;
	});
	$("th").css("background-color", "#aaa");
});
$("li a").attr("href", "#");
$("#default").click();
</script>
</body>
</html>